<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>EL PASSO Relying Party (RP) Demo</title>
</head>

<body>
  <h3>EL PASSO Relying Party (RP): For demo purpose only</h3>
  <p>
    Note: This demo is only for the purpose of showing how WASM ELPASSO RP
    works.
    <br />
    Author: Zhiyi Zhang (zhiyi@cs.ucla.edu)
  </p>

  <hr />

  <h4>Step 0: RP Setup</h4>
  <p>
    Please copy paste the IdP's public key here to set up the RP.
  </p>
  <textarea id="idp-pk" rows="5" cols="50"></textarea>
  <br />
  <button type="button" onclick="init()" value="0">Setup RP</button>
  <br />
  <p id="rp-init-result" style="width: 600px; overflow-wrap: break-word"></p>

  <hr />

  <h4>Step 1: Authenticate User</h4>
  <p>
    Please copy paste the sign on request generated by the user.
  </p>
  <textarea id="user-request" rows="5" cols="50"></textarea>
  <br />
  <button type="button" onclick="authenticate()">Authenticate User</button>
  <p id="authenticate-result" style="width: 600px; overflow-wrap: break-word"></p>

  <script>
    var Module = {
      onRuntimeInitialized: function () {
        Module.initPairing();
        console.log("init pairing");
      },
    };
    document.getElementById("idp-pk").value = "";

    var rp;

    function init() {
      var keyBase64 = document.getElementById("idp-pk").value;
      if (keyBase64.length == 0) {
        alert("Empty IdP's public key is detected.");
        return;
      }
      var pk = Module.PSPubKey.fromBufferString(Module.PSBuffer.fromBase64(keyBase64));
      rp = new Module.PSVerifier(pk);
      console.log("init RP");
      document.getElementById("rp-init-result").innerHTML = "Succeed!";
    }
  </script>
  <script async src="el-passo-rp.js"></script>
</body>

</html>